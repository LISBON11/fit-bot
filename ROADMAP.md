# üó∫Ô∏è FitBot ‚Äî –ü–æ—à–∞–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

> –ö–∞–∂–¥—ã–π –ø–æ–¥–ø—É–Ω–∫—Ç ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞.
> –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: [SYSTEM_DESIGN.md](file:///Users/elizavetagolubenko/Projects/fit-tel-bot/SYSTEM_DESIGN.md)

---

## –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### 1.1 Node.js + TypeScript –ø—Ä–æ–µ–∫—Ç

```prompt
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π Node.js + TypeScript –ø—Ä–æ–µ–∫—Ç –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 11 (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫), —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.

–ó–∞–¥–∞—á–∏:
- npm init + TypeScript —Å–æ strict-—Ä–µ–∂–∏–º–æ–º
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ SYSTEM_DESIGN.md (src/bot, src/services, src/stt, src/nlu, src/repositories, src/config, src/errors, src/logger, tests)
- Entry point src/index.ts —Å –ø—É—Å—Ç—ã–º main() –∏ graceful shutdown (SIGINT/SIGTERM)
- npm-—Å–∫—Ä–∏–ø—Ç—ã: dev (tsx watch), build, start
- .gitignore, .env.example —Å placeholder-–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ SYSTEM_DESIGN

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run build` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫.
```

---

### 1.2 ESLint + Prettier

```prompt
–ù–∞—Å—Ç—Ä–æ–π ESLint (flat config) –∏ Prettier –¥–ª—è TypeScript –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ü—Ä–∞–≤–∏–ª–∞: strict TypeScript, explicit return types (warn), no-unused-vars (error), no-explicit-any (warn), prettier –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è. SingleQuote, trailing commas, printWidth 100.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.
```

---

### 1.3 Jest

```prompt
–ù–∞—Å—Ç—Ä–æ–π Jest + ts-jest –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ü–æ–∫—Ä—ã—Ç–∏–µ: branches/functions/lines ‚â• 70%. –¢–µ—Å—Ç—ã –≤ tests/unit –∏ tests/integration. –î–æ–±–∞–≤—å smoke-—Ç–µ—Å—Ç. –°–∫—Ä–∏–ø—Ç—ã: test, test:watch, test:coverage.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm test` –ø—Ä–æ—Ö–æ–¥–∏—Ç.
```

---

### 1.4 Docker Compose –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```prompt
–°–æ–∑–¥–∞–π Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–°–µ—Ä–≤–∏—Å—ã: PostgreSQL 16 –∏ Redis 7. Healthcheck –¥–ª—è –æ–±–æ–∏—Ö. Volumes –¥–ª—è persistence. –ü–∞—Ä–æ–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `docker compose up -d` ‚Äî –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ healthy.
```

---

### 1.5 Prisma + —Å—Ö–µ–º–∞ –ë–î + seed

```prompt
–ù–∞—Å—Ç—Ä–æ–π Prisma ORM –∏ —Å–æ–∑–¥–∞–π –ø–æ–ª–Ω—É—é —Å—Ö–µ–º—É –ë–î –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 4 (–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ö–µ–º–∞ –ë–î). –¢–∞–º –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü, –∏–Ω–¥–µ–∫—Å–æ–≤, —Å–≤—è–∑–µ–π.

–ó–∞–¥–∞—á–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∏ Prisma, —Å–æ–∑–¥–∞–π schema.prisma –ø–æ ER-–¥–∏–∞–≥—Ä–∞–º–º–µ –∏–∑ SYSTEM_DESIGN.md
- –í—Å–µ –º–æ–¥–µ–ª–∏: User, AuthProvider, Workout, Exercise, ExerciseSynonym, UserExerciseMapping, WorkoutExercise, ExerciseSet, WorkoutComment
- –°–≤—è–∑–∏, –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å—ã ‚Äî –≤—Å—ë –ø–æ SYSTEM_DESIGN.md
- Enum WorkoutStatus (DRAFT, APPROVED, CANCELLED)
- –°–æ–∑–¥–∞–π seed-—Å–∫—Ä–∏–ø—Ç: 20-30 –±–∞–∑–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (back_squat, deadlift, bench_press –∏ —Ç.–ø.) + —Å–∏–Ω–æ–Ω–∏–º—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- –°–∫—Ä–∏–ø—Ç—ã: db:migrate, db:generate, db:seed, db:studio
- TSDoc-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –º–æ–¥–µ–ª—è–º –≤ schema.prisma –Ω–∞ —Ä—É—Å—Å–∫–æ–º

–ü—Ä–æ–≤–µ—Ä–∫–∞: –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, seed –≤—ã–ø–æ–ª–Ω–µ–Ω, `npx prisma studio` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.
```

---

### 1.6 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—à–∏–±–∫–∏

```prompt
–°–æ–∑–¥–∞–π –º–æ–¥—É–ª–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ—è –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª—ã 9 (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å), 10 (–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).

–ó–∞–¥–∞—á–∏:
1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (src/config/env.ts): Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (BOT_TOKEN, OPENAI_API_KEY, DATABASE_URL, REDIS_URL, LOG_LEVEL, NODE_ENV, PUBLISH_CHAT_ID). –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ.
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (src/logger/): pino —Å pino-pretty –≤ dev, JSON –≤ production. –§–∞–±—Ä–∏–∫–∞ –¥–ª—è child-–ª–æ–≥–≥–µ—Ä–æ–≤ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.
3. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ë–î** (src/config/database.ts): PrismaClient —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤, connect/disconnect —Å retry.
4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Redis** (src/config/redis.ts): ioredis, reconnect strategy, connect/disconnect.
5. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—à–∏–±–∫–∏** (src/errors/): AppError (–±–∞–∑–æ–≤—ã–π), NotFoundError, ValidationError, SttError, NluParseError, ExternalServiceError ‚Äî —Å–æ statusCode –∏ isOperational.
6. **–û–±–Ω–æ–≤–∏ index.ts**: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ ‚Üí –ª–æ–≥–≥–µ—Ä–∞ ‚Üí –ë–î ‚Üí Redis, graceful shutdown.
7. **–¢–µ—Å—Ç—ã**: –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫.

TSDoc –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

## –≠—Ç–∞–ø 2: Telegram-–±–æ—Ç (–∫–∞—Ä–∫–∞—Å)

### 2.1 grammY –±–æ—Ç + middleware

```prompt
–°–æ–∑–¥–∞–π –∫–∞—Ä–∫–∞—Å Telegram-–±–æ—Ç–∞ –Ω–∞ grammY –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 6 (Telegram-–±–æ—Ç: –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è, UX).

–ó–∞–¥–∞—á–∏:
1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞** (src/bot/bot.ts): grammY Bot —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (SessionData, user). –ü–ª–∞–≥–∏–Ω—ã: @grammyjs/conversations, @grammyjs/session.
2. **Auth middleware**: –ø—Ä–∏ –∫–∞–∂–¥–æ–º update ‚Äî –Ω–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id —á–µ—Ä–µ–∑ UserService (–ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ SYSTEM_DESIGN —Ä–∞–∑–¥–µ–ª 5).
3. **Error middleware**: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, user-friendly —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
4. **Logging middleware**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö update-–æ–≤ (—Ç–∏–ø, userId, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏).
5. **–ö–æ–º–∞–Ω–¥—ã**: /start (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ), /help (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è), /cancel (—Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è).
6. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ index.ts**: —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ middleware, –∑–∞–ø—É—Å–∫, graceful shutdown.
7. **–¢–µ—Å—Ç—ã**: auth middleware (–º–æ–∫ Prisma, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

–ù–ï –∑–∞–ø—É—Å–∫–∞–π –±–æ—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ (–Ω–µ—Ç BOT_TOKEN). –ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 2.2 Speech-to-Text (STT)

```prompt
–†–µ–∞–ª–∏–∑—É–π –æ–±—Ä–∞–±–æ—Ç–∫—É –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ STT –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 3.1 (Speech-to-Text).

–ó–∞–¥–∞—á–∏:
1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å STT** (src/stt/): –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π `SttService` —Å –º–µ—Ç–æ–¥–æ–º `transcribe(audioBuffer, language)`.
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è OpenAI Whisper** (src/stt/): —á–µ—Ä–µ–∑ `openai` npm-–ø–∞–∫–µ—Ç. Whisper API, —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'ru'. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Üí SttError. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏.
3. **Voice handler** (src/bot/handlers/): —Å–∫–∞—á–∞—Ç—å .oga —Ñ–∞–π–ª –∏–∑ Telegram (–≤ Buffer, –±–µ–∑ temp-—Ñ–∞–π–ª–æ–≤!), –ø–µ—Ä–µ–¥–∞—Ç—å –≤ STT, –≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç. Typing indicator –ø–æ–∫–∞ –∏–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞.
4. **–ü–æ–∫–∞** –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–π —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (NLU –ø–æ–¥–∫–ª—é—á–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º).
5. **–¢–µ—Å—Ç—ã**: –º–æ–∫ OpenAI –∫–ª–∏–µ–Ω—Ç–∞, –º–æ–∫ ctx.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 2.3 NLU-–ø–∞—Ä—Å–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

```prompt
–†–µ–∞–ª–∏–∑—É–π NLU-–ø–∞—Ä—Å–µ—Ä (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏) –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 3.2 (NLU / –ü–∞—Ä—Å–∏–Ω–≥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏). –¢–∞–º –æ–ø–∏—Å–∞–Ω—ã –ø–æ–¥—Ö–æ–¥ (LLM + structured output), —Ç–∏–ø—ã ParsedWorkout, –ø—Ä–æ–º–ø—Ç, –º–µ—Ö–∞–Ω–∏–∫–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–π.

–ó–∞–¥–∞—á–∏:
1. **–¢–∏–ø—ã** (src/nlu/): ParsedWorkout, ParsedExercise, ParsedSet, ParsedComment —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ –∏–∑ SYSTEM_DESIGN (—Ñ–æ–∫—É—Å, –º–µ—Å—Ç–æ, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –ø–æ–¥—Ö–æ–¥—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å body_part/side/sensation_type/raw_text).
2. **–ü—Ä–æ–º–ø—Ç** (src/nlu/prompts/): —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è GPT, –æ–±—ä—è—Å–Ω—è—é—â–∏–π –∫–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞. –ó–∞–¥–∞—ë—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è focus/location/comment types. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–µ—á–∞—Ç—å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.
3. **–ü–∞—Ä—Å–µ—Ä** (src/nlu/): –≤—ã–∑–æ–≤ OpenAI GPT (gpt-4o-mini) —Å response_format: json_object, temperature: 0. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Zod-—Å—Ö–µ–º—É. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚Üí NluParseError.
4. **Zod-—Å—Ö–µ–º–∞** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ GPT.
5. **–¢–µ—Å—Ç—ã**: –º–æ–∫ OpenAI, fixture-–æ—Ç–≤–µ—Ç—ã (–≤–∞–ª–∏–¥–Ω—ã–π, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, —Å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—è–º–∏).

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

## –≠—Ç–∞–ø 3: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### 3.1 –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (Exercise Registry)

```prompt
–†–µ–∞–ª–∏–∑—É–π —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏, —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è–º–∏ –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 7 (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏ –∏ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏). –¢–∞–º –æ–ø–∏—Å–∞–Ω—ã –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞, –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π), –º–µ—Ö–∞–Ω–∏–∫–∞ disambiguation.

–ó–∞–¥–∞—á–∏:
1. **Repository** (src/repositories/): CRUD –¥–ª—è exercises, exercise_synonyms, user_exercise_mappings. –ü–æ–∏—Å–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –ø–æ LOWER(text), –ø–æ–∏—Å–∫ –º–∞–ø–ø–∏–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, upsert –º–∞–ø–ø–∏–Ω–≥–∞ —Å use_count.
2. **Service** (src/services/): –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ `resolveExercise(inputText, userId)` ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ –±–ª–æ–∫-—Å—Ö–µ–º–µ –∏–∑ SYSTEM_DESIGN (user mapping ‚Üí synonym ‚Üí fuzzy ‚Üí not found). –ú–µ—Ç–æ–¥ `confirmMapping` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ú–µ—Ç–æ–¥ `getExerciseListForNlu()` –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞.
3. **–¢–∏–ø—ã**: ResolveResult = 'resolved' | 'ambiguous' | 'not_found'.
4. **–¢–µ—Å—Ç—ã**: –≤—Å–µ –≤–µ—Ç–∫–∏ resolveExercise (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å, –Ω–µ –Ω–∞–π–¥–µ–Ω–æ), confirmMapping.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 3.2 –°–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (Workout Service)

```prompt
–†–µ–∞–ª–∏–∑—É–π —Å–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (CRUD, draft-flow) –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 2 (Data Flow), —Ä–∞–∑–¥–µ–ª 6 (Workflow Draft ‚Üí Approve).

–ó–∞–¥–∞—á–∏:
1. **Repository** (src/repositories/): —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏/–ø–æ–¥—Ö–æ–¥–∞–º–∏/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ (Prisma nested create), –ø–æ–∏—Å–∫ –ø–æ id/–¥–∞—Ç–µ/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (transaction), —Ö—Ä–∞–Ω–µ–Ω–∏–µ message ID (source, preview, published).
2. **Service** (src/services/): 
   - `createDraft(userId, parsedWorkout)` ‚Äî —Ä–µ–∑–æ–ª–≤–∏—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ ExerciseService, —Å–æ–∑–¥–∞—ë—Ç draft. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è.
   - `approveDraft`, `cancelDraft`, `editWorkout`, `findByDate`, `getDraftForUser`
3. **–¢–∏–ø—ã**: CreateDraftResult = 'created' | 'needs_disambiguation'.
4. **–¢–µ—Å—Ç—ã**: –≤—Å–µ –º–µ—Ç–æ–¥—ã, –æ–±–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è createDraft.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 3.3 –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```prompt
–†–µ–∞–ª–∏–∑—É–π —Å–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 5 (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).

–ó–∞–¥–∞—á–∏:
1. **Repository** (src/repositories/): –ø–æ–∏—Å–∫ –ø–æ id, –ø–æ telegram_id (—á–µ—Ä–µ–∑ auth_providers), —Å–æ–∑–¥–∞–Ω–∏–µ User + AuthProvider –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
2. **Service** (src/services/): `getOrCreateByTelegram(telegramId, username?, firstName?)` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —ç—Ç–∞–ø–∞ MVP.
3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ auth middleware** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UserService –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
4. **–¢–µ—Å—Ç—ã**: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ, –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

## –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Äî –ø–æ–ª–Ω—ã–π flow

### 4.1 –ü–æ–ª–Ω—ã–π flow –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

```prompt
–†–µ–∞–ª–∏–∑—É–π –ø–æ–ª–Ω—ã–π conversation flow "–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞" –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 2 (Data Flow, sequence diagram), —Ä–∞–∑–¥–µ–ª 6 (FSM, workflow Draft ‚Üí Approve ‚Üí Edit ‚Üí Cancel, –ø—Ä–∏–º–µ—Ä –ø—Ä–µ–≤—å—é).

–≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∏ —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –º–æ–¥—É–ª—å –±–æ—Ç–∞. –û–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –µ–¥–∏–Ω—ã–π flow.

–ó–∞–¥–∞—á–∏:
1. **Conversation** (src/bot/conversations/): –∏—Å–ø–æ–ª—å–∑—É–π @grammyjs/conversations. Flow:
   - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç (–∏–∑ voice —á–µ—Ä–µ–∑ STT –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é)
   - –ü–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ NLU
   - Disambiguation —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞
   - –°–æ–∑–¥–∞–Ω–∏–µ draft —á–µ—Ä–µ–∑ WorkoutService
   - –ü–æ–∫–∞–∑ –ø—Ä–µ–≤—å—é + –∫–Ω–æ–ø–∫–∏ [‚úÖ Approve] [‚úèÔ∏è Edit] [‚ùå Cancel]
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫: approve ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è + —É–¥–∞–ª–µ–Ω–∏–µ voice, edit ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–æ–∫ ‚Üí –ø–æ–≤—Ç–æ—Ä, cancel ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ
2. **Formatter** (src/bot/formatters/): –∫—Ä–∞—Å–∏–≤–æ–µ –ø—Ä–µ–≤—å—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (—Ñ–æ—Ä–º–∞—Ç –∏–∑ SYSTEM_DESIGN —Ä–∞–∑–¥–µ–ª 6) + —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∫–∞–Ω–∞–ª. HTML parse_mode.
3. **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã** (src/bot/keyboards/): approve/edit/cancel, –≤—ã–±–æ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø—Ä–∏ disambiguation.
4. **Publisher** (src/services/): –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ PUBLISH_CHAT_ID, –≤–æ–∑–≤—Ä–∞—Ç message_id.
5. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: voice handler –∏ text handler –∑–∞–ø—É—Å–∫–∞—é—Ç —ç—Ç–æ—Ç conversation.
6. **–¢–µ—Å—Ç—ã**: formatter, publisher (–º–æ–∫ bot.api).

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 4.2 –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ

```prompt
–†–µ–∞–ª–∏–∑—É–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 6 (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ).

–ó–∞–¥–∞—á–∏:
1. **Conversation** (src/bot/conversations/): flow:
   - –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É (–∏–∑ –∫–æ–º–∞–Ω–¥—ã /edit, —Ç–µ–∫—Å—Ç–∞, –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ)
   - –ù–∞–π—Ç–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∑–∞ —ç—Ç—É –¥–∞—Ç—É
   - –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∫–∏ (—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å ‚Üí STT ‚Üí NLU)
   - NLU –ø–∞—Ä—Å–∏—Ç –ø—Ä–∞–≤–∫–∏ –∫–∞–∫ –¥–µ–ª—å—Ç—É (–¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è)
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø–æ–∫–∞–∑–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –ø—Ä–µ–≤—å—é + –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
2. **–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–µ–ª—å—Ç—ã**: –æ—Ç–¥–µ–ª—å–Ω—ã–π NLU-–ø—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∞ –Ω–µ –ø–æ–ª–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.
3. **–ö–æ–º–∞–Ω–¥–∞ /edit** + –ø–∞—Ç—Ç–µ—Ä–Ω –≤ text handler ("–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∑–∞...").
4. **–¢–µ—Å—Ç—ã**: –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç, flow.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

## –≠—Ç–∞–ø 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è MVP

### 5.1 Edge cases, UX, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```prompt
–û–±—Ä–∞–±–æ—Ç–∞–π –≤—Å–µ edge cases –∏ –æ—Ç—à–ª–∏—Ñ—É–π UX –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 2 (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ø–æ—Ç–æ–∫–µ, –¥–∏–∞–≥—Ä–∞–º–º–∞), —Ä–∞–∑–¥–µ–ª 8 (UX), —Ä–∞–∑–¥–µ–ª 10 (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫).

–ó–∞–¥–∞—á–∏:
1. **Edge cases**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ, —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–µ—Ä–∞–∑–±–∏—Ä–∞–µ–º—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–ø–æ–∫–∞–∑–∞—Ç—å raw text), —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–Ω–æ–ø–∫–∏, –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
2. **Typing indicator**: –≤–æ –≤—Ä–µ–º—è STT –∏ NLU ‚Äî typing action –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã.
3. **Graceful shutdown**: –¥–æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö handlers, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
4. **README.md**: –æ–ø–∏—Å–∞–Ω–∏–µ, prerequisites, —É—Å—Ç–∞–Ω–æ–≤–∫–∞, –∑–∞–ø—É—Å–∫, –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞, —Å—Ç–µ–∫.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 5.2 Docker + CI/CD

```prompt
–ü–æ–¥–≥–æ—Ç–æ–≤—å Docker-–æ–±—Ä–∞–∑ –∏ CI/CD –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 11 (Docker Compose, CI/CD).

–ó–∞–¥–∞—á–∏:
1. **Dockerfile**: multi-stage (build: npm ci + prisma generate + tsc ‚Üí production: –∫–æ–ø–∏—Ä—É–µ–º dist + node_modules + ffmpeg).
2. **docker-compose.yml**: –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å bot, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç postgres –∏ redis, .env, restart policy.
3. **GitHub Actions CI**: lint ‚Üí test ‚Üí build –Ω–∞ push main –∏ PR.
4. **.dockerignore**.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `docker build -t fitbot .` —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, `docker compose up -d` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.
```

---

### 5.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```prompt
–°–æ–∑–¥–∞–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö flow FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ó–∞–¥–∞—á–∏:
1. **–¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**: –æ—Ç–¥–µ–ª—å–Ω—ã–π jest-–∫–æ–Ω—Ñ–∏–≥, —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î, setup/teardown (–º–∏–≥—Ä–∞—Ü–∏–∏, –æ—á–∏—Å—Ç–∫–∞).
2. **–¢–µ—Å—Ç—ã workout flow**: —Å–æ–∑–¥–∞–Ω–∏–µ draft ‚Üí approve (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î), —Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí cancel (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ).
3. **–¢–µ—Å—Ç—ã exercise resolve**: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π resolve –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–ø–ø–∏–Ω–≥.
4. **–¢–µ—Å—Ç—ã user auth**: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ Telegram, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ = —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run test:integration`.
```

---

## –≠—Ç–∞–ø 6: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±—É–¥—É—â–µ–º—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 6.1 REST API –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```prompt
–°–æ–∑–¥–∞–π REST API –Ω–∞ Fastify –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 8 (–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–∞–∫ –±–æ—Ç –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª—è—Ç –±–∞–∑—É).

–ó–∞–¥–∞—á–∏:
1. Fastify-—Å–µ—Ä–≤–µ—Ä —Å pino-–ª–æ–≥–≥–µ—Ä–æ–º, cors, helmet.
2. CRUD-—Ä–æ—É—Ç—ã: /api/workouts (list, get, create, update, delete, approve), /api/exercises (list, create, search).
3. –û–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Å –±–æ—Ç–æ–º (WorkoutService, ExerciseService).
4. Zod-–≤–∞–ª–∏–¥–∞—Ü–∏—è request body.
5. –ó–∞–ø—É—Å–∫ –ø–æ —Ñ–ª–∞–≥—É ENABLE_API=true.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 6.2 JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```prompt
–î–æ–±–∞–≤—å JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è REST API –≤ FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª 5 (JWT –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–∏–≤—è–∑–∫–∞ Telegram).

–ó–∞–¥–∞—á–∏:
1. JWT-—Å–µ—Ä–≤–∏—Å: access token (15 –º–∏–Ω), refresh token (7 –¥–Ω–µ–π), verify.
2. Auth-—Ä–æ—É—Ç—ã: register (email+pass), login, refresh token, link-telegram (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–¥).
3. Auth middleware –¥–ª—è Fastify (–ø—Ä–æ–≤–µ—Ä–∫–∞ Bearer token).
4. –ö–æ–º–∞–Ω–¥–∞ –±–æ—Ç–∞ /link <code> ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```

---

### 6.3 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

```prompt
–°–æ–∑–¥–∞–π –±–∞–∑–æ–≤—ã–π –º–æ–¥—É–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è FitBot –≤ /Users/elizavetagolubenko/Projects/fit-tel-bot.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: SYSTEM_DESIGN.md ‚Äî —Ä–∞–∑–¥–µ–ª (–æ—á–µ–Ω—å –¥–∞–ª–µ–∫–∏–π –±—É–¥—É—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª).

–ó–∞–¥–∞—á–∏:
1. Analytics Service: –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é (–≤–µ—Å/–æ–±—ä—ë–º –∑–∞ –ø–µ—Ä–∏–æ–¥), –æ–±—ä—ë–º –ø–æ –º—ã—à–µ—á–Ω—ã–º –≥—Ä—É–ø–ø–∞–º, —á–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –æ—Ç—á—ë—Ç –ø–æ –∞—Å–∏–º–º–µ—Ç—Ä–∏—è–º.
2. SQL —á–µ—Ä–µ–∑ Prisma raw queries (GROUP BY, –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏).
3. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞: /stats (—Å–≤–æ–¥–∫–∞ –∑–∞ –º–µ—Å—è—Ü), /progress <—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ>.
4. API: GET /api/analytics/progress, /api/analytics/volume.

–ü—Ä–æ–≤–µ—Ä–∫–∞: `npm run lint && npm test`.
```
