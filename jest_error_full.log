(node:56471) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL src/bot/middleware/__tests__/errorMiddleware.test.ts
  Error Middleware
    ‚úì –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å next() –∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (1 ms)
    ‚úì –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å AppError (isOperational=true) –∏ –æ—Ç–≤–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏ (4 ms)
    ‚úì –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ (isOperational=false) –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç (1 ms)
    ‚úì –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å answerCallbackQuery, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ inline-–∫–Ω–æ–ø–∫—É
    ‚úï –Ω–µ –¥–æ–ª–∂–Ω–∞ –∫—Ä–∞—à–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–∞–º ctx.reply –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É (1 ms)

  ‚óè Error Middleware ‚Ä∫ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∫—Ä–∞—à–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–∞–º ctx.reply –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      77 |     // errorMiddleware –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≥–ª–æ—Ç–∏—Ç—å –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∏ –≤—ã–∫–∏–Ω—É—Ç—å –∏—Å—Ö–æ–¥–Ω—É—é –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ —ç–∫—Å–ø—Ä–µ—Å—Å—É/grammy.
      78 |     // –û–∂–∏–¥–∞–µ–º, —á—Ç–æ –ø—Ä–æ–º–∏—Å –∑–∞—Ä–µ–¥–∂–µ–∫—Ç–∏—Ç—Å—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π `First Error`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –æ–±—ã—á–Ω–∞—è –æ—à–∏–±–∫–∞ 500
    > 79 |     await expect(
         |           ^
      80 |       errorMiddleware(mockCtx as CustomContext, mockNext as unknown as NextFunction),
      81 |     ).rejects.toThrow('First Error');
      82 |     expect(mockCtx.reply).toHaveBeenCalled();

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/bot/middleware/__tests__/errorMiddleware.test.ts:79:11)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 4 passed, 5 total
Snapshots:   0 total
Time:        0.215 s, estimated 1 s
Ran all test suites matching /src\/bot\/middleware\/__tests__\/errorMiddleware.test.ts/i.
[15:21:47.950] [31mERROR[39m (56471): [36mError processing update[39m
    [35mmodule[39m: "ErrorMiddleware"
    [35mupdateId[39m: 123
    [35muserId[39m: 123456789
    err: {
      "type": "AppError",
      "message": "–ú–æ—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –æ—à–∏–±–∫–∞",
      "stack":
          AppError: –ú–æ—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –æ—à–∏–±–∫–∞
              at Object.<anonymous> (/Users/elizavetagolubenko/Projects/fit-tel-bot/src/bot/middleware/__tests__/errorMiddleware.test.ts:33:22)
              at Promise.then.completed (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:298:28)
              at new Promise (<anonymous>)
              at callAsyncCircusFn (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:231:10)
              at _callCircusTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:316:40)
              at _runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:252:3)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:126:9)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:121:9)
              at run (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:71:3)
              at runAndTransformResultsToJestFormat (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
              at jestAdapter (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
              at runTestInternal (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:367:16)
              at runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:444:34)
      "statusCode": 400,
      "isOperational": true,
      "name": "AppError"
    }
[15:21:47.954] [31mERROR[39m (56471): [36mError processing update[39m
    [35mmodule[39m: "ErrorMiddleware"
    [35mupdateId[39m: 123
    [35muserId[39m: 123456789
    err: {
      "type": "Error",
      "message": "Database went away",
      "stack":
          Error: Database went away
              at Object.<anonymous> (/Users/elizavetagolubenko/Projects/fit-tel-bot/src/bot/middleware/__tests__/errorMiddleware.test.ts:43:26)
              at Promise.then.completed (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:298:28)
              at new Promise (<anonymous>)
              at callAsyncCircusFn (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:231:10)
              at _callCircusTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:316:40)
              at _runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:252:3)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:126:9)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:121:9)
              at run (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:71:3)
              at runAndTransformResultsToJestFormat (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
              at jestAdapter (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
              at runTestInternal (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:367:16)
              at runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:444:34)
    }
[15:21:47.954] [31mERROR[39m (56471): [36mError processing update[39m
    [35mmodule[39m: "ErrorMiddleware"
    [35mupdateId[39m: 123
    [35muserId[39m: 123456789
    err: {
      "type": "AppError",
      "message": "–ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞",
      "stack":
          AppError: –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞
              at Object.<anonymous> (/Users/elizavetagolubenko/Projects/fit-tel-bot/src/bot/middleware/__tests__/errorMiddleware.test.ts:57:22)
              at Promise.then.completed (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:298:28)
              at new Promise (<anonymous>)
              at callAsyncCircusFn (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:231:10)
              at _callCircusTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:316:40)
              at _runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:252:3)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:126:9)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:121:9)
              at run (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:71:3)
              at runAndTransformResultsToJestFormat (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
              at jestAdapter (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
              at runTestInternal (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:367:16)
              at runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:444:34)
      "statusCode": 400,
      "isOperational": true,
      "name": "AppError"
    }
[15:21:47.954] [31mERROR[39m (56471): [36mError processing update[39m
    [35mmodule[39m: "ErrorMiddleware"
    [35mupdateId[39m: 123
    [35muserId[39m: 123456789
    err: {
      "type": "Error",
      "message": "First Error",
      "stack":
          Error: First Error
              at Object.<anonymous> (/Users/elizavetagolubenko/Projects/fit-tel-bot/src/bot/middleware/__tests__/errorMiddleware.test.ts:70:27)
              at Promise.then.completed (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:298:28)
              at new Promise (<anonymous>)
              at callAsyncCircusFn (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:231:10)
              at _callCircusTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:316:40)
              at _runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:252:3)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:126:9)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:121:9)
              at run (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:71:3)
              at runAndTransformResultsToJestFormat (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
              at jestAdapter (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
              at runTestInternal (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:367:16)
              at runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:444:34)
    }
[15:21:47.955] [31mERROR[39m (56471): [36mFailed to send error message to user[39m
    [35mmodule[39m: "ErrorMiddleware"
    [35mupdateId[39m: 123
    err: {
      "type": "Error",
      "message": "Telegram API down",
      "stack":
          Error: Telegram API down
              at Object.<anonymous> (/Users/elizavetagolubenko/Projects/fit-tel-bot/src/bot/middleware/__tests__/errorMiddleware.test.ts:75:61)
              at Promise.then.completed (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:298:28)
              at new Promise (<anonymous>)
              at callAsyncCircusFn (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/utils.js:231:10)
              at _callCircusTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:316:40)
              at _runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:252:3)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:126:9)
              at _runTestsForDescribeBlock (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:121:9)
              at run (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/run.js:71:3)
              at runAndTransformResultsToJestFormat (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
              at jestAdapter (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
              at runTestInternal (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:367:16)
              at runTest (/Users/elizavetagolubenko/Projects/fit-tel-bot/node_modules/jest-runner/build/runTest.js:444:34)
    }
